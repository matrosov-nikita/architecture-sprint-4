### Список необходимых логов

#### INFO

- Каждое изменение статуса заказа, поля: идентификатор заказа, предыдущий статус заказа, новый статус заказа, время изменения статуса заказа
- Данные расчета стоимости изготовления изделия: идентификатор заказа, время (продолжительность) изготовления, время когда расчет закончен, параметры расчета
- Запись в очередь (CRM <-> MES): время записи в очередь, идентификатор заказа, тип события, которое произошло, доп. данные для этого типа
- Создание заказа через API: время создания, идентификатор пользователя, модель изделия


#### WARNING
- Неудачная попытка отправить событие в очередь (еще есть повторные попытки) - идентификатор заказа, тип события, время отправки, ошибка отправки, номер попытки (retryCount)
- В API создания заказа переданы невалидные данные - идентификатор пользователя, входящие данные (перс. данные маскируем), ошибка


#### ERROR
- Все ошибки API сервера (500) - идентификатор заказа идентификатор пользователя, ошибка сервера, входные данные (перс. данные маскируем) в метод API
- Dead-letter сообщения в очереди - время возникновения события, идентификатор заказа, тип сообщения, причина-ошибка по которой сообщение не может обработаться
- Расчет стоимости завершился с ошибкой - время возникновения ошибки, ошибка, идентификатор заказа


### Мотивация
- Ускорение процесса диагностики ошибок. Логи помогают быстро локализовать и устранить причины сбоев.
- Логирование предупреждающих событий (уровень WARNING) помогает выявить потенциальные проблемы в логике кода.
- Повышение качества и скорости разработки. Логи предоставляют данные для анализа типичных ошибок и их частоты.

#### Бизнес-метрики, на которые влияет логирование
- Снижение числа пользовательских жалоб, за счет быстрой локализации и реакции на ошибки.
- Повышение прозрачности и информативности бизнес-процессов.
- Снижение времени обработки заказа, за счет выявления наиболее узких мест.

  Настройка логирования в первую очередь должна быть выполнена для систем, где критично фиксировать ошибки и события, влияющие на бизнес-процессы и пользовательский опыт:
- CRM API и база данных CRM - Управляет заказами, клиентскими данными, статусами — это ядро бизнес-логики.
- MES API и база данных MES - Обеспечивает производственные процессы, любые сбои повлияют на выполнение заказов.
- RabbitMQ - Центральный механизм для передачи событий между CRM и MES, любые сбои в очереди (зависшие сообщения, ошибки обработки) критически влияют на выполнение заказов.

### Предлагаемое решение
Для логирования будем использовать стек ELK (ElasticSearch + Kibana + Logstash + Filebeat): [logger_jewerly.drawio](logger_jewerly.drawio)

#### Политика безопасности в отношении логов
- Все чувствительные и персональные данные будут маскироваться.
- Доступ к логам и трейсингу будут иметь только пользователи с ролью Developer.
- Для доступа к логам и трейсингу нужно будет пройти корпоративную аутентификацию.

#### Политика хранения в отношении логов
- Будем использовать отдельные индексы для отдельных критически важных сервисов (MES API, CRM API, RabbitMQ)
- Для менее значимых индексов можно использовать один индекс
- Размер индекса ограничим 10Гб (maxSize=10gb), при достижении 10Гб за счет ролловера будет создаваться новый индекс, старый индекс будет использоваться только для чтения
- Индексы старше полугода будут автоматически удаляться. В качестве альтернативы можно рассмотреть перенос старых индексов в холодное хранилище (например, на HDD)

### Настройка алертинга
Алерты должны быть настроены для быстрого реагирования на критические ситуации:
- Резкий рост ошибок (например, HTTP 500) в CRM API или MES API.
- Всплеск количества запросов (RPS) в MES API, CRM API или API Gateway.
- Увеличение времени обработки запросов (latency) в CRM или MES API.

### Дополнительное задание, сравнительный анализ систем для логов 

| **Критерий**              | **ELK**                                | **OpenSearch**                       | **Splunk**                             |
|---------------------------|----------------------------------------|--------------------------------------|----------------------------------------|
| **Лицензия**               | Elastic License                        | Apache License 2.0                   | Проприетарная                          |
| **Производительность**     | Хорошая производительность на больших объемах данных | Подобная производительность как у ELK | Отличная производительность при очень больших объемах данных |
| **Масштабируемость**       | Высокая масштабируемость, поддержка кластеризации и горизонтального масштабирования | Поддерживает масштабируемость, особенно в распределенных системах | Высокая масштабируемость, но дорогостоящие инфраструктурные ресурсы |
| **Управление данными**     | Мощные функции индексации, хранения и поиска | Аналогичные возможности индексации и поиска, на базе Elasticsearch | Индексация и поиск логов, но с меньшей гибкостью настройки |
| **Интерфейс пользователя** | Kibana, мощный интерфейс визуализации данных | OpenSearch Dashboards, аналог Kibana | Простой интерфейс с большими возможностями для отчетности и визуализации |
| **Интеграция с другими сервисами** | Хорошая поддержка интеграции с другими инструментами (APM, Monitoring) | Хорошая интеграция с AWS, поддержка интеграции с Kibana | Множество интеграций с облачными сервисами и другими системами |
| **Сообщество и поддержка**  | Активное сообщество, поддержка через Elastic | Сообщество OpenSearch, поддержка от AWS | Платная поддержка, но с высоким качеством сервиса |

Почему выбор выпал на ELK?:


### Анализ схемы текущей системы:
1. Отсутствуют системы логирования, мониторинга, которые позволяют подсвечивать узкие места в системе.
2. Для каждого изделия расчет в MES происходит каждый раз заново, даже если модели изделий являются одинаковыми или однотипными (какие-то параметры совпадают). Это увеличивает нагрузку на систему MES.
3. База данных MES использует один инстанс для хранения как "горячих" данных (активных заказов), так и "холодных" данных (завершённых заказов). Это создаёт сложности с производительностью, так как из-за низкой селективности поля "статус" индексация на это поле неэффективна, а с ростом объёма данных поиск по статусам становится всё медленнее. Кроме того, единичный инстанс базы данных не оптимален для обработки большого объёма запросов, что приводит к замедлению работы системы и увеличению времени обработки заказов.
4. Система не использует горизонтальное масштабирование и не имеет централизованного оркестратора, такого как Kubernetes, для управления контейнеризованными приложениями. Это ограничивает способность системы масштабироваться, повышает риски перегрузки серверов и снижает её отказоустойчивость.
5. CI/CD деплой в release и production окружения осуществляется вручную. Это замедляет процесс выпуска новых версий и увеличивает риски, связанные с человеческим фактором.
6. Отсутствие механизма регулировки нагрузки между CRM и MES приводит к перегрузке системы MES при большом объеме запросов. Например, в моменты пиковых нагрузок на Shop или API, MES система не имеет способа замедлить поступление сообщений или приостановить обработку, что в свою очередь может вызывать сбои и нестабильную работу.
7. API для внешних пользователей не имеет механизма балансировки нагрузки и регулировки запросов, что приводит к перегрузке при пиковых нагрузках.



### Инициативы, которые необходимы для устранения нежелательных ситуаций:
1. Внедрить ELK для сбора и анализа логов, настроить мониторинг и визуализацию метрик через Prometheus + Grafana, настроить алерты для критических событий. Все это в совокупности
   снизит время на диагностику системы, повысит стабильность и прозрачность работы системы.
2. Предусмотреть кэширование в MES для расчета стоимости изделий. В качестве ключа кэширования можно использовать хэш на основе параметров модели (модель изделия, кол-во полигонов, геометрические параметры изделия, ...).
Предусмотреть инвалидацию ключей в кэше - например по TTL и по изменению алгоритма расчета стоимости.
3. Разделить горячие и холодные данные, например через партиционирование таблиц. Для горячих данных использовать оптимизированные частичные индексы.
Для улучшения производительности БД внедрить шардирование и репликацию.
4. Контейнеризация приложений: Каждое приложение (онлайн-магазин, CRM, MES) должно быть контейнеризовано с помощью Docker. Это обеспечит консистентность в средах разработки, тестирования и продакшн.
   Использование Kubernetes для оркестрации: Kubernetes должен использоваться для управления контейнерами, автоматического масштабирования, мониторинга состояния и восстановления в случае сбоев. Kubernetes обеспечит высокую доступность, отказоустойчивость и лёгкость в масштабировании приложений по мере роста нагрузки.
5. Интеграция с CI/CD инструментами (например, Jenkins) для автоматического деплоя на все окружения после успешного прохождения всех тестов. Внедрение интеграционных и end-to-end (E2E) тестов в pipeline. Настройка автоматических проверок качества кода (например, линтеры, проверки на безопасность), чтобы не допускать релиз некорректного кода.
6. Внедрение backpressure между CRM и MES позволит контролировать поток сообщений, предотвращая перегрузку систем. Такой механизм будет замедлять поступление сообщений в моменты пиковых нагрузок, предотвращая сбои и снижая нагрузку на систему.
7. Внедрение API Gateway, который будет включать rate-limiting, балансировать нагрузку по нескольким инстансам сервиса.

### Приоритет инициатив и образ новой архитектуры

Через полгода разработчики системы должны в real-time видеть все проблемные места системы, а также на основе метрик прогнозировать будущий рост системы. Система сможет масштабироваться в ответ на увеличивающиеся нагрузки, как в плане увеличения объёма данных, так и количества пользователей.
Оптимизация базы данных, кэширование и использование API Gateway для балансировки нагрузки обеспечат быструю работу системы.

В первые полгода в первую очередь нужно стабилизировать состояние текущей системы и подготовить плацдарм для масштабирования, поэтому выделил 3 основных задачи:

Порядок внедрения инициатив:
1. Внедрение логирования и мониторинга (первоначальный шаг для выявления текущих проблем).
2. Внедрение кэширования в MES (ускорение работы системы).
3. Внедрение API Gateway с балансировкой нагрузки и rate-limiting (для предотвращения перегрузки).
4. Внедрение механизма backpressure между CRM и MES (для регулировки нагрузки между сервисами).
5. Разделение данных в базе данных MES и внедрение шардирования и репликации (улучшение производительности базы данных).
6. Контейнеризация приложений и использование Kubernetes (для масштабируемости и отказоустойчивости).
7. Автоматизация CI/CD процессов (для ускорения разработки и релизов).








